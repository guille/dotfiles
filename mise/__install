#!/usr/bin/env bash
# shellcheck disable=SC1091

set -e

source "$SCRIPT_BASE_DIR/common"

##
# Set up mise-en-place
##

module_name=mise

if command_exists mise; then
	infoprint "[$module_name] upgrading mise tools"
	mise upgrade
fi


infoprint "[$module_name] setting up mise's autocompletion"
mise use --global usage

# Always regenerate completions
mise completion zsh  > /usr/local/share/zsh/site-functions/_mise

infoprint "[$module_name] mise config flags"
mise settings set experimental true

gitignore "mise.local.toml"

infoprint "[$module_name] installing global mise tools"
mise use -g helm-ls@latest

infoprint "[$module_name] pruning outdated mise tools"
mise prune

infoprint "[$module_name] activating for this session"
eval "$(mise activate zsh)"

if [[ "$DOTFILES_DISTRO" == "Fedora" ]]; then
	infoprint "[$module_name] installing tools with mise"
	mise use --global eza@latest
	mise use --global opencode@latest
	mise use --global typst@latest
	mise use --global kubectl@latest
	mise use --global kubectx@latest
	mise use --global github:atanunq/viu
fi

#!/usr/bin/env bash

COLOR='\033[0;32m'
NC='\033[0m' # No Color

command_exists () {
    type "$1" &> /dev/null ;
}

infoprint () {
	echo -e "${COLOR}${1}${NC}"
}

# Select the right install command and update system
local INSTALL="sudo pacman -S --needed --noconfirm --noprogressbar"
# sudo pacman -Syuq --noconfirm

# Install zsh and set it as default shell
if command_exists zsh; then
	infoprint "zsh already installed"
else
	$INSTALL zsh
	chsh -s /bin/zsh
fi

infoprint "Installing programs from source/apps"
cat sources/apps | xargs $INSTALL 2> /dev/null
# TODO: Add banshee

if command_exists rvm; then
	infoprint "rvm already installed"
	# rvm get head 1> /dev/null
	# gem update -q 1> /dev/null

else
	infoprint "Installing rvm"
	\curl -sSL https://get.rvm.io | bash -s head
	rvm install ruby-head
	infoprint "Installing gems"
	GEM_INSTALL="gem install"
	cat sources/gems | xargs $GEM_INSTALL
fi


# MPD and NCMPCPP
mkdir -p ~/.mpd
mkdir -p ~/.mpd/lyrics
mkdir -p ~/.mpd/playlists
touch ~/.mpd/mpd.log
touch ~/.mpd/tag_cache
touch ~/.mpd/mpdstate
touch ~/.mpd/mpd.pid
touch ~/.mpd/sticker.sql

# Does the symlinks
. links

infoprint "Installing pip packages"
PIP_INSTALL="pip install --user"
cat sources/pip | xargs $PIP_INSTALL 1> /dev/null

feh --bg-scale ~/wallpaper.jpg

# Create to-do list
infoprint "Creating a to-do file with more possible configurations"

echo "* Set-up tv renamer in thunar-custom-actions" >> todo
echo "* Set up git config --global user.name and user.email" >> todo
echo "* Github credential git config --global credential.https://github.com.username myusername" >> todo
echo "* Install AUR packages" >> todo
echo "   * sublime-text-dev" >> todo
echo "   * focuswriter" >> todo
echo "   * pepper-flash" >> todo
echo "* Install package control for Sublime" >> todo
echo "   * Install Agila" >> todo
echo "   * Install AllAutoComplete" >> todo
echo "   * Install BracketHighlighter" >> todo
echo "   * Install Elixir" >> todo
echo "   * Install SublimeLinter, -contrib-elixirc, -ruby" >> todo
echo "* Change the chromium desktop file to execute with the flag --process-per-site" >> todo
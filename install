#!/usr/bin/env bash

COLOR='\033[0;32m'
NC='\033[0m' # No Color

command_exists () {
	type "$1" &> /dev/null ;
}

infoprint () {
	echo -e "${COLOR}${1}${NC}"
}

# Select the right install command and update system
INSTALL="sudo pacman -S --needed --noconfirm --noprogressbar"
sudo pacman -Syuq --noconfirm

# Install zsh and set it as default shell
if command_exists zsh; then
	infoprint "zsh already installed"
else
	$INSTALL zsh
	chsh -s /bin/zsh
fi

infoprint "Installing programs from source/apps"
xargs -a <(cat sources/apps) sudo pacman -S --needed --noconfirm --noprogressbar
# Allows comments on source lists
# xargs -a <(cat sources/apps | \grep -v '^#') sudo pacman -S --needed --noconfirm --noprogressbar

# RUBY
if command_exists rvm; then
	infoprint "rvm already installed"
	rvm get head 1> /dev/null
	gem update -q 1> /dev/null
else
	infoprint "Installing rvm"
	\curl -sSL https://get.rvm.io | bash -s head
	source ~/.rvm/scripts/rvm
	rvm install ruby-head
	#rvm install jruby-head
	rvm use --default ruby-head
	infoprint "Installing gems"
	xargs -a <(cat sources/gems) gem install
fi

# PYTHON
infoprint "Installing pip packages"
xargs -a <(cat sources/pip) pip install --user

# ELIXIR
# mix local.hex
# mix archive.install https://github.com/phoenixframework/archives/raw/master/phoenix_new.ez

# AUR

xargs -a <(cat sources/aur | \grep -v '^#') sudo pacaur -S --needed --noconfirm --noprogressbar

# MPD and NCMPCPP
mkdir -p ~/.mpd/lyrics
mkdir -p ~/.mpd/playlists
mkdir -p ~/.ncmpcpp
touch ~/.mpd/mpd.log
touch ~/.mpd/tag_cache
touch ~/.mpd/mpdstate
touch ~/.mpd/mpd.pid
touch ~/.mpd/sticker.sql

# Create to-do list
infoprint "Creating a to-do file with more possible configurations"

echo "* localectl set-x11-keymap es" >> todo
echo "* Gtk themes with lxappearance" >> todo
echo "* Install package control for Sublime" >> todo
echo "   * Install Agila" >> todo
echo "   * Install AllAutoComplete" >> todo
echo "   * Install BracketHighlighter" >> todo
echo "   * Install Elixir" >> todo
echo "   * Install Crystal" >> todo
echo "   * Install SublimeLinter, -contrib-elixirc, -ruby" >> todo
echo "* Create the symbolic links running \"source links\"" >> todo
